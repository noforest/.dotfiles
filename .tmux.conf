# set -g default-terminal "tmux-256color"
set -g default-terminal "xterm-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -ag terminal-overrides ",*:Tc"  # Enable true color

# THEME
set -g pane-border-style "fg=#698DDA"
set -g pane-active-border-style "bg=default fg=#698DDA"

set -g pane-border-style "fg=default"
set -g pane-active-border-style "bg=default fg=default"
# set -g status-bg black
# set -g status-fg white
# set -g window-status-current-style bg=white,fg=black,bold
# set -g status-interval 60
# set -g status-left-length 30
# set -g status-left '#[fg=green](#S) '
# set -g status-right '#[fg=white]%H:%M#[default]'


set -g allow-rename on
set -g set-titles on
set -g set-titles-string '#T'
setw -g mode-keys vi



# GENERAL
set -g base-index 1
set-option -g history-limit 100000
set -g mouse on
set -s escape-time 0
unbind-key Escape
bind-key b set-option status
set-environment -g DISPLAY $DISPLAY

# PLUGINS
# List of plugins
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'niksingh710/minimal-tmux-status'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'thewtex/tmux-mem-cpu-load'
set -g @plugin 'tmux-plugins/tmux-yank'
# set -g @plugin 'noscript/tmux-mighty-scroll'

############################################################################################

# These are the default values used inside the plugin to achieve the preview shown above.
set -g @minimal-tmux-fg "#000000"
set -g @minimal-tmux-bg "#698DDA"
set -g @minimal-tmux-indicator-str "  #S  "
# expanded icon (fullscreen icon)
set -g @minimal-tmux-expanded-icon "󰊓 "
set -g status-right-length 100
set -g status-left-length 100
set -g @minimal-tmux-status-right "RAM: #{ram_percentage} | CPU: #{cpu_percentage} | %A %h-%d %H:%M "

# set -g @minimal-tmux-status-right "RAM: #(/home/for/.tmux/plugins/tmux-mem-cpu-load/tmux-mem-cpu-load -m 2 --interval 2) | CPU: #{cpu_percentage} | %A %h-%d %H:%M"

############################################################################################


# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'


# KEYBINDS
set -g xterm-keys on


# Dans le mode normal : entrer en copy-mode et scroller
bind -n C-Up   if -F "#{pane_in_mode}" "send-keys -X halfpage-up"   "copy-mode \; send-keys -X halfpage-up"
bind -n C-Down if -F "#{pane_in_mode}" "send-keys -X halfpage-down" "copy-mode \; send-keys -X halfpage-down"

# Dans copy-mode-vi : scroller seulement
bind -T copy-mode-vi C-Up   send-keys -X halfpage-up
bind -T copy-mode-vi C-Down send-keys -X halfpage-down

# Ctrl+s : toggle copy-mode
bind-key -n C-s if-shell -F "#{pane_in_mode}" \
    "send-keys C-c" \
    "copy-mode"

# Désactive C-f si c'est nvim
    bind-key -n C-f if-shell \
        '[ "#{pane_current_command}" = "nvim" ]' \
        'send-keys C-f' \
        'send-keys "fuzzy_cd\n"'

# # Désactive C-d si c'est nvim
#         bind-key -n C-d if-shell \
#             '[ "#{pane_current_command}" = "nvim" ]' \
#             'send-keys C-d' \
#             'send-keys "confirm-exit\n"'


# Visual selection (character by character)
bind-key -T copy-mode-vi v send-keys -X begin-selection
# Visual line selection
bind-key -T copy-mode-vi V send-keys -X select-line
# Visual block selection (Ctrl-v)
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

bind -n M-z next-window
bind -n M-a previous-window

# Alt+w  (M-w) fermer le panneau courant
bind -n M-w kill-pane

# Alt+j pour aller au panneau suivant
bind -n M-j select-pane -t :.+
# Alt+k pour aller au panneau précédent
bind -n M-k select-pane -t :.-

# Comme nvim sauf avec ALT et non avec SPACE
# Alt+n : nouvelle fenêtre divisée horizontalement (split horizontal)
bind -n M-v split-window -h -c "#{pane_current_path}"

# Alt+v : nouvelle fenêtre divisée verticalement (split vertical)
bind -n M-n split-window -v -c "#{pane_current_path}"

# Alt+e : lancer nnn (explorateur de fichiers) dans un nouveau pane flottant
bind -n M-e display-popup -d '#{pane_current_path}' -x C -y C -h 88% -w 85% -E 'tmux new-session yazi \; set status off'



bind -n M-b set -g status

# Alt + Shift + Flèches pour resize
bind -n M-S-Left  resize-pane -L 5
bind -n M-S-Right resize-pane -R 5
bind -n M-S-Up    resize-pane -U 5
bind -n M-S-Down  resize-pane -D 5

# Alt + Entrée  ou Alt + c: nouvelle fenêtre (current path)
bind -n M-Enter new-window -c "#{pane_current_path}"
bind -n M-c new-window -c "#{pane_current_path}"

# bind -n M-Enter new-window
# # Alt + o : nouvelle fenêtre dans le répertoire de la fenêtre active
# bind -n M-\* new-window -c "#{pane_current_path}"

# Goto window 1 to 5 using Alt + & é " ' (
bind -n -N "Goto window 1" M-& select-window -t 1
bind -n -N "Goto window 2" M-é select-window -t 2
bind -n -N "Goto window 3" M-\" select-window -t 3
bind -n -N "Goto window 4" M-\' select-window -t 4
bind -n -N "Goto window 5" M-\( select-window -t 5


set -g @yank_action "copy-pipe"


# Hook qui désactive le status bar pour la session float
set-hook -g session-created 'if-shell "[ #{session_name} = float ]" "set-option -t float status off"'

bind -n M-f if-shell '[ "#{session_name}" != "float" ]' \
"display-popup -d '#{pane_current_path}' -x C -y C -h 89% -w 85% -E 'tmux new-session -A -s float" \
"display-message 'Cannot open a popup inside another popup!'"
